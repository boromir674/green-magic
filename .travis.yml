os: linux
language: python

env:
  global:
    - LD_PRELOAD=/lib/x86_64-linux-gnu/libSegFault.so
    - SEGFAULT_SIGNALS=all
    - TOX_SKIP_MISSING_INTERPRETERS="False"
    - secure: SbeD7piafLsAqewW4UWA2YI3d/tPsPrhIuJxsKqc7DTqWH9KeTLnVFRNtNelZ6mz/z4Tv9pnWnFfUgr47/LtH/Iacb/ldPkJk7EECkUZYfWuNsXLmwq0W3ZIot/9pPbeqHrLN3qkwoVp/aKAV+yQipl6Hpe78ajs5d+/LQhHv+LG9KjXwEnSnd9YBEiojT60i+i4nSgbOS9/Zzqy3DydLm6TK6UO8kwzsJlIoevKGYvpymqIE4hoWIE2UTx+mTqndAlSSqINYpX4Sp4gwcV3M+kSZY+98hMiBOoJeZkC73/kK6QJqdU7ppYpA1/MQUM8IaVp7p0/XlTxKBc8ZfpuKmF+alond+xZUEfLwa14MnQ5A0U0V60UJsROmpnWfptHz6XqRLZ4XgUVhnubNz7HGjIoKnUJC/isj4bHdli7qm92TgiYWb0i4pJZYjK+4xy8nItU47/Mn1epqOLJzSt2bHFma/df2HGUFtqjcQCzunnxeUFPDAZ/rD768ocbNxA7QuGdNajp8iV3En7xg7CMScbpz2lKSWMHUKmJgGudBKfxLOkwxpPk6cLFAtlGNLDHS3m9R4BFU4ibIXd/+BfduB+397p91xzyd3M4kF/w5tpFdQKIwN4/b/balDSSNLGVcIVAHtT0RFufU9TZ3+H8gNcCK114lJPIrksipyy1R/g=

before_install:
  - python --version
  - pip --version
  - uname -a
  - lsb_release -a
  - sudo python -m pip install -U pip
  - python -m pip install tox
  - sudo apt-get install jq
  - curl -LSs "$(curl -LSs https://api.github.com/repos/codacy/codacy-coverage-reporter/releases/latest | jq -r '.assets | map({name, browser_download_url} | select(.name | endswith(".jar"))) | .[0].browser_download_url')" -o codacy-coverage-reporter-assembly.jar


cache: pip
script: tox -vv

jobs:
  include:
  - stage: Build_n_test
    env: TOXENV=check
  - stage: Build_n_test
    python: '3.6'
    env: TOXENV=clean,py36-cov
  - stage: Build_n_test
    python: '3.7'
    env: TOXENV=clean,py37-cov
  - stage: Build_n_test
    python: '3.8'
    env: TOXENV=clean,py38-cov

after_success:
  - tox -e codecov
  - java -jar codacy-coverage-reporter-assembly.jar report -l Python -r test-results/junit-test-results.xml

after_failure:
  - more .tox/log/* | cat
  - more .tox/*/log/* | cat

#deploy:
#  provider: script
#  script: .travis/deploy.sh
#  on:
#    all_branches: true


#notifications:
#  email:
#    on_success: never
#    on_failure: never
